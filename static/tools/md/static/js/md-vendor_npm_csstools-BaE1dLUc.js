class l extends Error{sourceStart;sourceEnd;parserState;constructor(e,r,o,n){super(e),this.name="ParseError",this.sourceStart=r,this.sourceEnd=o,this.parserState=n}}class A extends l{token;constructor(e,r,o,n,i){super(e,r,o,n),this.token=i}}const E={UnexpectedNewLineInString:"Unexpected newline while consuming a string token.",UnexpectedEOFInString:"Unexpected EOF while consuming a string token.",UnexpectedEOFInComment:"Unexpected EOF while consuming a comment.",UnexpectedEOFInURL:"Unexpected EOF while consuming a url token.",UnexpectedEOFInEscapedCodePoint:"Unexpected EOF while consuming an escaped code point.",UnexpectedCharacterInURL:"Unexpected character while consuming a url token.",InvalidEscapeSequenceInURL:"Invalid escape sequence while consuming a url token.",InvalidEscapeSequenceAfterBackslash:'Invalid escape sequence after "\\"'};function k(...t){let e="";for(let r=0;r<t.length;r++)e+=t[r][1];return e}const x=13,p=45,F=10,N=43,I=65533;function ae(t){return t.source.codePointAt(t.cursor)===60&&t.source.codePointAt(t.cursor+1)===33&&t.source.codePointAt(t.cursor+2)===p&&t.source.codePointAt(t.cursor+3)===p}function f(t){return t>=48&&t<=57}function ce(t){return t>=65&&t<=90}function ue(t){return t>=97&&t<=122}function U(t){return t>=48&&t<=57||t>=97&&t<=102||t>=65&&t<=70}function de(t){return ue(t)||ce(t)}function M(t){return de(t)||pe(t)||t===95}function ne(t){return M(t)||f(t)||t===p}function pe(t){return t===183||t===8204||t===8205||t===8255||t===8256||t===8204||192<=t&&t<=214||216<=t&&t<=246||248<=t&&t<=893||895<=t&&t<=8191||8304<=t&&t<=8591||11264<=t&&t<=12271||12289<=t&&t<=55295||63744<=t&&t<=64975||65008<=t&&t<=65533||t===0||!!R(t)||t>=65536}function le(t){return t===11||t===127||0<=t&&t<=8||14<=t&&t<=31}function V(t){return t===F||t===x||t===12}function y(t){return t===32||t===F||t===9||t===x||t===12}function R(t){return t>=55296&&t<=57343}function b(t){return t.source.codePointAt(t.cursor)===92&&!V(t.source.codePointAt(t.cursor+1)??-1)}function H(t,e){return e.source.codePointAt(e.cursor)===p?e.source.codePointAt(e.cursor+1)===p||!!M(e.source.codePointAt(e.cursor+1)??-1)||e.source.codePointAt(e.cursor+1)===92&&!V(e.source.codePointAt(e.cursor+2)??-1):!!M(e.source.codePointAt(e.cursor)??-1)||b(e)}function te(t){return t.source.codePointAt(t.cursor)===N||t.source.codePointAt(t.cursor)===p?!!f(t.source.codePointAt(t.cursor+1)??-1)||t.source.codePointAt(t.cursor+1)===46&&f(t.source.codePointAt(t.cursor+2)??-1):t.source.codePointAt(t.cursor)===46?f(t.source.codePointAt(t.cursor+1)??-1):f(t.source.codePointAt(t.cursor)??-1)}function fe(t){return t.source.codePointAt(t.cursor)===47&&t.source.codePointAt(t.cursor+1)===42}function he(t){return t.source.codePointAt(t.cursor)===p&&t.source.codePointAt(t.cursor+1)===p&&t.source.codePointAt(t.cursor+2)===62}var s,D,j;function Pe(t){switch(t){case s.OpenParen:return s.CloseParen;case s.CloseParen:return s.OpenParen;case s.OpenCurly:return s.CloseCurly;case s.CloseCurly:return s.OpenCurly;case s.OpenSquare:return s.CloseSquare;case s.CloseSquare:return s.OpenSquare;default:return null}}function me(t){switch(t[0]){case s.OpenParen:return[s.CloseParen,")",-1,-1,void 0];case s.CloseParen:return[s.OpenParen,"(",-1,-1,void 0];case s.OpenCurly:return[s.CloseCurly,"}",-1,-1,void 0];case s.CloseCurly:return[s.OpenCurly,"{",-1,-1,void 0];case s.OpenSquare:return[s.CloseSquare,"]",-1,-1,void 0];case s.CloseSquare:return[s.OpenSquare,"[",-1,-1,void 0];default:return null}}function ve(t,e){for(e.advanceCodePoint(2);;){const r=e.readCodePoint();if(r===void 0){const o=[s.Comment,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,void 0];return t.onParseError(new A(E.UnexpectedEOFInComment,e.representationStart,e.representationEnd,["4.3.2. Consume comments","Unexpected EOF"],o)),o}if(r===42&&e.source.codePointAt(e.cursor)!==void 0&&e.source.codePointAt(e.cursor)===47){e.advanceCodePoint();break}}return[s.Comment,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,void 0]}function $(t,e){const r=e.readCodePoint();if(r===void 0)return t.onParseError(new l(E.UnexpectedEOFInEscapedCodePoint,e.representationStart,e.representationEnd,["4.3.7. Consume an escaped code point","Unexpected EOF"])),I;if(U(r)){const o=[r];let n;for(;(n=e.source.codePointAt(e.cursor))!==void 0&&U(n)&&o.length<6;)o.push(n),e.advanceCodePoint();y(e.source.codePointAt(e.cursor)??-1)&&(e.source.codePointAt(e.cursor)===x&&e.source.codePointAt(e.cursor+1)===F&&e.advanceCodePoint(),e.advanceCodePoint());const i=parseInt(String.fromCodePoint(...o),16);return i===0||R(i)||i>1114111?I:i}return r===0||R(r)?I:r}function K(t,e){const r=[];for(;;){const o=e.source.codePointAt(e.cursor)??-1;if(o===0||R(o))r.push(I),e.advanceCodePoint(+(o>65535)+1);else if(ne(o))r.push(o),e.advanceCodePoint(+(o>65535)+1);else{if(!b(e))return r;e.advanceCodePoint(),r.push($(t,e))}}}function Ce(t,e){e.advanceCodePoint();const r=e.source.codePointAt(e.cursor);if(r!==void 0&&(ne(r)||b(e))){let o=j.Unrestricted;H(0,e)&&(o=j.ID);const n=K(t,e);return[s.Hash,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:String.fromCodePoint(...n),type:o}]}return[s.Delim,"#",e.representationStart,e.representationEnd,{value:"#"}]}function Se(t,e){let r=D.Integer;for(e.source.codePointAt(e.cursor)!==N&&e.source.codePointAt(e.cursor)!==p||e.advanceCodePoint();f(e.source.codePointAt(e.cursor)??-1);)e.advanceCodePoint();if(e.source.codePointAt(e.cursor)===46&&f(e.source.codePointAt(e.cursor+1)??-1))for(e.advanceCodePoint(2),r=D.Number;f(e.source.codePointAt(e.cursor)??-1);)e.advanceCodePoint();if(e.source.codePointAt(e.cursor)===101||e.source.codePointAt(e.cursor)===69){if(f(e.source.codePointAt(e.cursor+1)??-1))e.advanceCodePoint(2);else{if(e.source.codePointAt(e.cursor+1)!==p&&e.source.codePointAt(e.cursor+1)!==N||!f(e.source.codePointAt(e.cursor+2)??-1))return r;e.advanceCodePoint(3)}for(r=D.Number;f(e.source.codePointAt(e.cursor)??-1);)e.advanceCodePoint()}return r}function Q(t,e){let r;{const i=e.source.codePointAt(e.cursor);i===p?r="-":i===N&&(r="+")}const o=Se(0,e),n=parseFloat(e.source.slice(e.representationStart,e.representationEnd+1));if(H(0,e)){const i=K(t,e);return[s.Dimension,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:n,signCharacter:r,type:o,unit:String.fromCodePoint(...i)}]}return e.source.codePointAt(e.cursor)===37?(e.advanceCodePoint(),[s.Percentage,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:n,signCharacter:r}]):[s.Number,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:n,signCharacter:r,type:o}]}function Ee(t){for(;y(t.source.codePointAt(t.cursor)??-1);)t.advanceCodePoint();return[s.Whitespace,t.source.slice(t.representationStart,t.representationEnd+1),t.representationStart,t.representationEnd,void 0]}(function(t){t.Comment="comment",t.AtKeyword="at-keyword-token",t.BadString="bad-string-token",t.BadURL="bad-url-token",t.CDC="CDC-token",t.CDO="CDO-token",t.Colon="colon-token",t.Comma="comma-token",t.Delim="delim-token",t.Dimension="dimension-token",t.EOF="EOF-token",t.Function="function-token",t.Hash="hash-token",t.Ident="ident-token",t.Number="number-token",t.Percentage="percentage-token",t.Semicolon="semicolon-token",t.String="string-token",t.URL="url-token",t.Whitespace="whitespace-token",t.OpenParen="(-token",t.CloseParen=")-token",t.OpenSquare="[-token",t.CloseSquare="]-token",t.OpenCurly="{-token",t.CloseCurly="}-token",t.UnicodeRange="unicode-range-token"})(s||(s={})),(function(t){t.Integer="integer",t.Number="number"})(D||(D={})),(function(t){t.Unrestricted="unrestricted",t.ID="id"})(j||(j={}));class ke{cursor=0;source="";representationStart=0;representationEnd=-1;constructor(e){this.source=e}advanceCodePoint(e=1){this.cursor=this.cursor+e,this.representationEnd=this.cursor-1}readCodePoint(){const e=this.source.codePointAt(this.cursor);if(e!==void 0)return this.cursor=this.cursor+1,this.representationEnd=this.cursor-1,e}unreadCodePoint(e=1){this.cursor=this.cursor-e,this.representationEnd=this.cursor-1}resetRepresentation(){this.representationStart=this.cursor,this.representationEnd=-1}}function ge(t,e){let r="";const o=e.readCodePoint();for(;;){const n=e.readCodePoint();if(n===void 0){const i=[s.String,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:r}];return t.onParseError(new A(E.UnexpectedEOFInString,e.representationStart,e.representationEnd,["4.3.5. Consume a string token","Unexpected EOF"],i)),i}if(V(n)){e.unreadCodePoint();const i=[s.BadString,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,void 0];return t.onParseError(new A(E.UnexpectedNewLineInString,e.representationStart,e.source.codePointAt(e.cursor)===x&&e.source.codePointAt(e.cursor+1)===F?e.representationEnd+2:e.representationEnd+1,["4.3.5. Consume a string token","Unexpected newline"],i)),i}if(n===o)return[s.String,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:r}];if(n!==92)n===0||R(n)?r+=String.fromCodePoint(I):r+=String.fromCodePoint(n);else{if(e.source.codePointAt(e.cursor)===void 0)continue;if(V(e.source.codePointAt(e.cursor)??-1)){e.source.codePointAt(e.cursor)===x&&e.source.codePointAt(e.cursor+1)===F&&e.advanceCodePoint(),e.advanceCodePoint();continue}r+=String.fromCodePoint($(t,e))}}}function Ae(t){return!(t.length!==3||t[0]!==117&&t[0]!==85||t[1]!==114&&t[1]!==82||t[2]!==108&&t[2]!==76)}function X(t,e){for(;;){const r=e.source.codePointAt(e.cursor);if(r===void 0)return;if(r===41)return void e.advanceCodePoint();b(e)?(e.advanceCodePoint(),$(t,e)):e.advanceCodePoint()}}function Oe(t,e){for(;y(e.source.codePointAt(e.cursor)??-1);)e.advanceCodePoint();let r="";for(;;){if(e.source.codePointAt(e.cursor)===void 0){const n=[s.URL,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:r}];return t.onParseError(new A(E.UnexpectedEOFInURL,e.representationStart,e.representationEnd,["4.3.6. Consume a url token","Unexpected EOF"],n)),n}if(e.source.codePointAt(e.cursor)===41)return e.advanceCodePoint(),[s.URL,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:r}];if(y(e.source.codePointAt(e.cursor)??-1)){for(e.advanceCodePoint();y(e.source.codePointAt(e.cursor)??-1);)e.advanceCodePoint();if(e.source.codePointAt(e.cursor)===void 0){const n=[s.URL,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:r}];return t.onParseError(new A(E.UnexpectedEOFInURL,e.representationStart,e.representationEnd,["4.3.6. Consume a url token","Consume as much whitespace as possible","Unexpected EOF"],n)),n}return e.source.codePointAt(e.cursor)===41?(e.advanceCodePoint(),[s.URL,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:r}]):(X(t,e),[s.BadURL,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,void 0])}const o=e.source.codePointAt(e.cursor);if(o===34||o===39||o===40||le(o??-1)){X(t,e);const n=[s.BadURL,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,void 0];return t.onParseError(new A(E.UnexpectedCharacterInURL,e.representationStart,e.representationEnd,["4.3.6. Consume a url token",`Unexpected U+0022 QUOTATION MARK ("), U+0027 APOSTROPHE ('), U+0028 LEFT PARENTHESIS (() or non-printable code point`],n)),n}if(o===92){if(b(e)){e.advanceCodePoint(),r+=String.fromCodePoint($(t,e));continue}X(t,e);const n=[s.BadURL,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,void 0];return t.onParseError(new A(E.InvalidEscapeSequenceInURL,e.representationStart,e.representationEnd,["4.3.6. Consume a url token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"],n)),n}e.source.codePointAt(e.cursor)===0||R(e.source.codePointAt(e.cursor)??-1)?(r+=String.fromCodePoint(I),e.advanceCodePoint()):(r+=e.source[e.cursor],e.advanceCodePoint())}}function Y(t,e){const r=K(t,e);if(e.source.codePointAt(e.cursor)!==40)return[s.Ident,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:String.fromCodePoint(...r)}];if(Ae(r)){e.advanceCodePoint();let o=0;for(;;){const n=y(e.source.codePointAt(e.cursor)??-1),i=y(e.source.codePointAt(e.cursor+1)??-1);if(n&&i){o+=1,e.advanceCodePoint(1);continue}const a=n?e.source.codePointAt(e.cursor+1):e.source.codePointAt(e.cursor);if(a===34||a===39)return o>0&&e.unreadCodePoint(o),[s.Function,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:String.fromCodePoint(...r)}];break}return Oe(t,e)}return e.advanceCodePoint(),[s.Function,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{value:String.fromCodePoint(...r)}]}function we(t){return!(t.source.codePointAt(t.cursor)!==117&&t.source.codePointAt(t.cursor)!==85||t.source.codePointAt(t.cursor+1)!==N||t.source.codePointAt(t.cursor+2)!==63&&!U(t.source.codePointAt(t.cursor+2)??-1))}function ye(t,e){e.advanceCodePoint(2);const r=[],o=[];let n;for(;(n=e.source.codePointAt(e.cursor))!==void 0&&r.length<6&&U(n);)r.push(n),e.advanceCodePoint();for(;(n=e.source.codePointAt(e.cursor))!==void 0&&r.length<6&&n===63;)o.length===0&&o.push(...r),r.push(48),o.push(70),e.advanceCodePoint();if(!o.length&&e.source.codePointAt(e.cursor)===p&&U(e.source.codePointAt(e.cursor+1)??-1))for(e.advanceCodePoint();(n=e.source.codePointAt(e.cursor))!==void 0&&o.length<6&&U(n);)o.push(n),e.advanceCodePoint();if(!o.length){const c=parseInt(String.fromCodePoint(...r),16);return[s.UnicodeRange,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{startOfRange:c,endOfRange:c}]}const i=parseInt(String.fromCodePoint(...r),16),a=parseInt(String.fromCodePoint(...o),16);return[s.UnicodeRange,e.source.slice(e.representationStart,e.representationEnd+1),e.representationStart,e.representationEnd,{startOfRange:i,endOfRange:a}]}function Te(t,e){const r=Ie(t),o=[];for(;!r.endOfFile();)o.push(r.nextToken());return o.push(r.nextToken()),o}function Ie(t,e){const r=t.css.valueOf(),o=t.unicodeRangesAllowed??!1,n=new ke(r),i={onParseError:Ue};return{nextToken:function(){n.resetRepresentation();const c=n.source.codePointAt(n.cursor);if(c===void 0)return[s.EOF,"",-1,-1,void 0];if(c===47&&fe(n))return ve(i,n);if(o&&(c===117||c===85)&&we(n))return ye(0,n);if(M(c))return Y(i,n);if(f(c))return Q(i,n);switch(c){case 44:return n.advanceCodePoint(),[s.Comma,",",n.representationStart,n.representationEnd,void 0];case 58:return n.advanceCodePoint(),[s.Colon,":",n.representationStart,n.representationEnd,void 0];case 59:return n.advanceCodePoint(),[s.Semicolon,";",n.representationStart,n.representationEnd,void 0];case 40:return n.advanceCodePoint(),[s.OpenParen,"(",n.representationStart,n.representationEnd,void 0];case 41:return n.advanceCodePoint(),[s.CloseParen,")",n.representationStart,n.representationEnd,void 0];case 91:return n.advanceCodePoint(),[s.OpenSquare,"[",n.representationStart,n.representationEnd,void 0];case 93:return n.advanceCodePoint(),[s.CloseSquare,"]",n.representationStart,n.representationEnd,void 0];case 123:return n.advanceCodePoint(),[s.OpenCurly,"{",n.representationStart,n.representationEnd,void 0];case 125:return n.advanceCodePoint(),[s.CloseCurly,"}",n.representationStart,n.representationEnd,void 0];case 39:case 34:return ge(i,n);case 35:return Ce(i,n);case N:case 46:return te(n)?Q(i,n):(n.advanceCodePoint(),[s.Delim,n.source[n.representationStart],n.representationStart,n.representationEnd,{value:n.source[n.representationStart]}]);case F:case x:case 12:case 9:case 32:return Ee(n);case p:return te(n)?Q(i,n):he(n)?(n.advanceCodePoint(3),[s.CDC,"-->",n.representationStart,n.representationEnd,void 0]):H(0,n)?Y(i,n):(n.advanceCodePoint(),[s.Delim,"-",n.representationStart,n.representationEnd,{value:"-"}]);case 60:return ae(n)?(n.advanceCodePoint(4),[s.CDO,"<!--",n.representationStart,n.representationEnd,void 0]):(n.advanceCodePoint(),[s.Delim,"<",n.representationStart,n.representationEnd,{value:"<"}]);case 64:if(n.advanceCodePoint(),H(0,n)){const P=K(i,n);return[s.AtKeyword,n.source.slice(n.representationStart,n.representationEnd+1),n.representationStart,n.representationEnd,{value:String.fromCodePoint(...P)}]}return[s.Delim,"@",n.representationStart,n.representationEnd,{value:"@"}];case 92:{if(b(n))return Y(i,n);n.advanceCodePoint();const P=[s.Delim,"\\",n.representationStart,n.representationEnd,{value:"\\"}];return i.onParseError(new A(E.InvalidEscapeSequenceAfterBackslash,n.representationStart,n.representationEnd,["4.3.1. Consume a token","U+005C REVERSE SOLIDUS (\\)","The input stream does not start with a valid escape sequence"],P)),P}}return n.advanceCodePoint(),[s.Delim,n.source[n.representationStart],n.representationStart,n.representationEnd,{value:n.source[n.representationStart]}]},endOfFile:function(){return n.source.codePointAt(n.cursor)===void 0}}}function Ue(){}const xe=Object.values(s);function re(t){return!!Array.isArray(t)&&!(t.length<4)&&!!xe.includes(t[0])&&typeof t[1]=="string"&&typeof t[2]=="number"&&typeof t[3]=="number"}function Z(t){if(!t)return!1;switch(t[0]){case s.Whitespace:case s.Comment:return!0;default:return!1}}function Fe(t){return!!t&&t[0]===s.Comma}function _(t){return!!t&&t[0]===s.Comment}function S(t){return!!t&&t[0]===s.Delim}function O(t){return!!t&&t[0]===s.EOF}function Ne(t){return!!t&&t[0]===s.Function}function m(t){return!!t&&t[0]===s.Ident}function G(t){return!!t&&t[0]===s.Whitespace}function Re(t){return!!t&&t[0]===s.OpenParen}function Le(t){return!!t&&t[0]===s.CloseParen}function be(t){return!!t&&t[0]===s.OpenSquare}function De(t){return!!t&&t[0]===s.OpenCurly}var h;function qe(t){let e=t.slice();return(r,o,n)=>{let i=-1;for(let a=e.indexOf(o);a<e.length&&(i=r.indexOf(e[a]),i===-1||i<n);a++);return i===-1||i===n&&o===r[n]&&(i++,i>=r.length)?-1:(e=r.slice(),i)}}function ee(t,e){const r=e[0];if(Re(r)||De(r)||be(r)){const o=Be(t,e);return{advance:o.advance,node:o.node}}if(Ne(r)){const o=We(t,e);return{advance:o.advance,node:o.node}}if(G(r)){const o=se(t,e);return{advance:o.advance,node:o.node}}if(_(r)){const o=Je(t,e);return{advance:o.advance,node:o.node}}return{advance:1,node:new J(r)}}(function(t){t.Function="function",t.SimpleBlock="simple-block",t.Whitespace="whitespace",t.Comment="comment",t.Token="token"})(h||(h={}));class oe{value=[];indexOf(e){return this.value.indexOf(e)}at(e){if(typeof e=="number")return e<0&&(e=this.value.length+e),this.value[e]}forEach(e,r){if(this.value.length===0)return;const o=qe(this.value);let n=0;for(;n<this.value.length;){const i=this.value[n];let a;if(r&&(a={...r}),e({node:i,parent:this,state:a},n)===!1)return!1;if(n=o(this.value,i,n),n===-1)break}}walk(e,r){this.value.length!==0&&this.forEach((o,n)=>e(o,n)!==!1&&(!("walk"in o.node)||!this.value.includes(o.node)||o.node.walk(e,o.state)!==!1)&&void 0,r)}}class q extends oe{type=h.Function;name;endToken;constructor(e,r,o){super(),this.name=e,this.endToken=r,this.value=o}getName(){return this.name[4].value}normalize(){O(this.endToken)&&(this.endToken=[s.CloseParen,")",-1,-1,void 0])}tokens(){return O(this.endToken)?[this.name,...this.value.flatMap(e=>e.tokens())]:[this.name,...this.value.flatMap(e=>e.tokens()),this.endToken]}toString(){const e=this.value.map(r=>re(r)?k(r):r.toString()).join("");return k(this.name)+e+k(this.endToken)}toJSON(){return{type:this.type,name:this.getName(),tokens:this.tokens(),value:this.value.map(e=>e.toJSON())}}isFunctionNode(){return q.isFunctionNode(this)}static isFunctionNode(e){return!!e&&e instanceof q&&e.type===h.Function}}function We(t,e){const r=[];let o=1;for(;;){const n=e[o];if(!n||O(n))return t.onParseError(new l("Unexpected EOF while consuming a function.",e[0][2],e[e.length-1][3],["5.4.9. Consume a function","Unexpected EOF"])),{advance:e.length,node:new q(e[0],n,r)};if(Le(n))return{advance:o+1,node:new q(e[0],n,r)};if(Z(n)){const a=ie(t,e.slice(o));o+=a.advance,r.push(...a.nodes);continue}const i=ee(t,e.slice(o));o+=i.advance,r.push(i.node)}}class W extends oe{type=h.SimpleBlock;startToken;endToken;constructor(e,r,o){super(),this.startToken=e,this.endToken=r,this.value=o}normalize(){if(O(this.endToken)){const e=me(this.startToken);e&&(this.endToken=e)}}tokens(){return O(this.endToken)?[this.startToken,...this.value.flatMap(e=>e.tokens())]:[this.startToken,...this.value.flatMap(e=>e.tokens()),this.endToken]}toString(){const e=this.value.map(r=>re(r)?k(r):r.toString()).join("");return k(this.startToken)+e+k(this.endToken)}toJSON(){return{type:this.type,startToken:this.startToken,tokens:this.tokens(),value:this.value.map(e=>e.toJSON())}}isSimpleBlockNode(){return W.isSimpleBlockNode(this)}static isSimpleBlockNode(e){return!!e&&e instanceof W&&e.type===h.SimpleBlock}}function Be(t,e){const r=Pe(e[0][0]);if(!r)throw new Error("Failed to parse, a mirror variant must exist for all block open tokens.");const o=[];let n=1;for(;;){const i=e[n];if(!i||O(i))return t.onParseError(new l("Unexpected EOF while consuming a simple block.",e[0][2],e[e.length-1][3],["5.4.8. Consume a simple block","Unexpected EOF"])),{advance:e.length,node:new W(e[0],i,o)};if(i[0]===r)return{advance:n+1,node:new W(e[0],i,o)};if(Z(i)){const c=ie(t,e.slice(n));n+=c.advance,o.push(...c.nodes);continue}const a=ee(t,e.slice(n));n+=a.advance,o.push(a.node)}}class B{type=h.Whitespace;value;constructor(e){this.value=e}tokens(){return this.value}toString(){return k(...this.value)}toJSON(){return{type:this.type,tokens:this.tokens()}}isWhitespaceNode(){return B.isWhitespaceNode(this)}static isWhitespaceNode(e){return!!e&&e instanceof B&&e.type===h.Whitespace}}function se(t,e){let r=0;for(;;){const o=e[r];if(!G(o))return{advance:r,node:new B(e.slice(0,r))};r++}}class L{type=h.Comment;value;constructor(e){this.value=e}tokens(){return[this.value]}toString(){return k(this.value)}toJSON(){return{type:this.type,tokens:this.tokens()}}isCommentNode(){return L.isCommentNode(this)}static isCommentNode(e){return!!e&&e instanceof L&&e.type===h.Comment}}function Je(t,e){return{advance:1,node:new L(e[0])}}function ie(t,e){const r=[];let o=0;for(;;){if(G(e[o])){const n=se(0,e.slice(o));o+=n.advance,r.push(n.node);continue}if(!_(e[o]))return{advance:o,nodes:r};r.push(new L(e[o])),o++}}class J{type=h.Token;value;constructor(e){this.value=e}tokens(){return[this.value]}toString(){return this.value[1]}toJSON(){return{type:this.type,tokens:this.tokens()}}isTokenNode(){return J.isTokenNode(this)}static isTokenNode(e){return!!e&&e instanceof J&&e.type===h.Token}}function Me(t,e){const r={onParseError:(()=>{})},o=[...t];if(t.length===0)return[];O(o[o.length-1])&&o.push([s.EOF,"",o[o.length-1][2],o[o.length-1][3],void 0]);const n=[];let i=[],a=0;for(;;){if(!o[a]||O(o[a]))return i.length&&n.push(i),n;if(Fe(o[a])){n.push(i),i=[],a++;continue}const c=ee(r,t.slice(a));i.push(c.node),a+=c.advance}}function Ve(t){return B.isWhitespaceNode(t)}function He(t){return L.isCommentNode(t)}function je(t){return J.isTokenNode(t)}class z{parts;constructor(e){this.parts=e}tokens(){return[...this.parts]}slice(e,r){const o=[];for(let i=0;i<this.parts.length;i++)m(this.parts[i])&&o.push(i);const n=o.slice(e,r);return new z(this.parts.slice(n[0],n[n.length-1]+1))}concat(e){const r=[s.Delim,".",-1,-1,{value:"."}];return new z([...this.parts.filter(o=>m(o)||S(o)),r,...e.parts.filter(o=>m(o)||S(o))])}segments(){return this.parts.filter(e=>m(e)).map(e=>e[4].value)}name(){return this.parts.filter(e=>m(e)||S(e)).map(e=>e[1]).join("")}equal(e){const r=this.segments(),o=e.segments();if(r.length!==o.length)return!1;for(let n=0;n<r.length;n++)if(r[n]!==o[n])return!1;return!0}toString(){return k(...this.parts)}toJSON(){return{parts:this.parts,segments:this.segments(),name:this.name()}}}function $e(t,e){e.forEach(r=>{const o=r.segments();e:for(let n=0;n<o.length;n++){const i=r.slice(0,n+1),a=i.segments();let c=-1,P=0;for(let g=0;g<t.length;g++){const T=t[g].segments();let w=0;t:for(let v=0;v<T.length;v++){const C=T[v],d=a[v];if(d===C&&v+1===a.length)continue e;if(d!==C){if(d!==C)break t}else w++}w>=P&&(c=g,P=w)}c===-1?t.push(i):t.splice(c+1,0,i)}})}function ze(t,e){const r=Me(t),o=(()=>{}),n=["6.4.2. Layer Naming and Nesting","Layer name syntax","<layer-name> = <ident> [ '.' <ident> ]*"],i=t[0][2],a=t[t.length-1][3],c=[];for(let P=0;P<r.length;P++){const g=r[P];for(let d=0;d<g.length;d++){const u=g[d];if(!je(u)&&!He(u)&&!Ve(u))return o(new l(`Invalid cascade layer name. Invalid layer name part "${u.toString()}"`,i,a,n)),[]}const T=g.flatMap(d=>d.tokens());let w=!1,v=!1,C=null;for(let d=0;d<T.length;d++){const u=T[d];if(!(Z(u)||m(u)||S(u)&&u[4].value==="."))return o(new l(`Invalid cascade layer name. Invalid character "${u[1]}"`,i,a,n)),[];if(!w&&S(u))return o(new l("Invalid cascade layer name. Layer names can not start with a dot.",i,a,n)),[];if(w){if(G(u)){v=!0;continue}if(v&&_(u))continue;if(v)return o(new l("Invalid cascade layer name. Encountered unexpected whitespace between layer name parts.",i,a,n)),[];if(m(C)&&m(u))return o(new l("Invalid cascade layer name. Layer name parts must be separated by dots.",i,a,n)),[];if(S(C)&&S(u))return o(new l("Invalid cascade layer name. Layer name parts must not be empty.",i,a,n)),[]}m(u)&&(w=!0),(m(u)||S(u))&&(C=u)}if(!C)return o(new l("Invalid cascade layer name. Empty layer name.",i,a,n)),[];if(S(C))return o(new l("Invalid cascade layer name. Layer name must not end with a dot.",i,a,n)),[];c.push(new z(T))}return c}function Ke(t,e){return ze(Te({css:t}))}function Ge(t,e){let r=t.parent;for(;r;)if(r.type==="atrule"&&r.name.toLowerCase()==="supports"){if(e.test(r.params))return!0;r=r.parent}else r=r.parent;return!1}export{$e as a,Ge as h,Ke as p};
