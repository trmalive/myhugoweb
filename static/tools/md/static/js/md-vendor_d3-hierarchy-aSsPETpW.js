function N(e){var n=0,t=e.children,r=t&&t.length;if(!r)n=1;else for(;--r>=0;)n+=t[r].value;e.value=n}function C(){return this.eachAfter(N)}function j(e,n){let t=-1;for(const r of this)e.call(n,r,++t,this);return this}function R(e,n){for(var t=this,r=[t],h,c,u=-1;t=r.pop();)if(e.call(n,t,++u,this),h=t.children)for(c=h.length-1;c>=0;--c)r.push(h[c]);return this}function W(e,n){for(var t=this,r=[t],h=[],c,u,s,_=-1;t=r.pop();)if(h.push(t),c=t.children)for(u=0,s=c.length;u<s;++u)r.push(c[u]);for(;t=h.pop();)e.call(n,t,++_,this);return this}function D(e,n){let t=-1;for(const r of this)if(e.call(n,r,++t,this))return r}function H(e){return this.eachAfter(function(n){for(var t=+e(n.data)||0,r=n.children,h=r&&r.length;--h>=0;)t+=r[h].value;n.value=t})}function L(e){return this.eachBefore(function(n){n.children&&n.children.sort(e)})}function M(e){for(var n=this,t=O(n,e),r=[n];n!==t;)n=n.parent,r.push(n);for(var h=r.length;e!==t;)r.splice(h,0,e),e=e.parent;return r}function O(e,n){if(e===n)return e;var t=e.ancestors(),r=n.ancestors(),h=null;for(e=t.pop(),n=r.pop();e===n;)h=e,e=t.pop(),n=r.pop();return h}function T(){for(var e=this,n=[e];e=e.parent;)n.push(e);return n}function b(){return Array.from(this)}function q(){var e=[];return this.eachBefore(function(n){n.children||e.push(n)}),e}function E(){var e=this,n=[];return e.each(function(t){t!==e&&n.push({source:t.parent,target:t})}),n}function*F(){var e=this,n,t=[e],r,h,c;do for(n=t.reverse(),t=[];e=n.pop();)if(yield e,r=e.children)for(h=0,c=r.length;h<c;++h)t.push(r[h]);while(t.length)}function S(e,n){e instanceof Map?(e=[void 0,e],n===void 0&&(n=J)):n===void 0&&(n=I);for(var t=new y(e),r,h=[t],c,u,s,_;r=h.pop();)if((u=n(r.data))&&(_=(u=Array.from(u)).length))for(r.children=u,s=_-1;s>=0;--s)h.push(c=u[s]=new y(u[s])),c.parent=r,c.depth=r.depth+1;return t.eachBefore(P)}function G(){return S(this).eachBefore(K)}function I(e){return e.children}function J(e){return Array.isArray(e)?e[1]:null}function K(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function P(e){var n=0;do e.height=n;while((e=e.parent)&&e.height<++n)}function y(e){this.data=e,this.depth=this.height=0,this.parent=null}y.prototype=S.prototype={constructor:y,count:C,each:j,eachAfter:W,eachBefore:R,find:D,sum:H,sort:L,path:M,ancestors:T,descendants:b,leaves:q,links:E,copy:G,[Symbol.iterator]:F};function Q(e,n){return e.parent===n.parent?1:2}function m(e){var n=e.children;return n?n[0]:e.t}function B(e){var n=e.children;return n?n[n.length-1]:e.t}function U(e,n,t){var r=t/(n.i-e.i);n.c-=r,n.s+=t,e.c+=r,n.z+=t,n.m+=t}function V(e){for(var n=0,t=0,r=e.children,h=r.length,c;--h>=0;)c=r[h],c.z+=n,c.m+=n,n+=c.s+(t+=c.c)}function X(e,n,t){return e.a.parent===n.parent?e.a:t}function A(e,n){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=n}A.prototype=Object.create(y.prototype);function Y(e){for(var n=new A(e,0),t,r=[n],h,c,u,s;t=r.pop();)if(c=t._.children)for(t.children=new Array(s=c.length),u=s-1;u>=0;--u)r.push(h=t.children[u]=new A(c[u],u)),h.parent=t;return(n.parent=new A(null,0)).children=[n],n}function Z(){var e=Q,n=1,t=1,r=null;function h(i){var d=Y(i);if(d.eachAfter(c),d.parent.m=-d.z,d.eachBefore(u),r)i.eachBefore(_);else{var p=i,a=i,l=i;i.eachBefore(function(o){o.x<p.x&&(p=o),o.x>a.x&&(a=o),o.depth>l.depth&&(l=o)});var f=p===a?1:e(p,a)/2,g=f-p.x,x=n/(a.x+f+g),z=t/(l.depth||1);i.eachBefore(function(o){o.x=(o.x+g)*x,o.y=o.depth*z})}return i}function c(i){var d=i.children,p=i.parent.children,a=i.i?p[i.i-1]:null;if(d){V(i);var l=(d[0].z+d[d.length-1].z)/2;a?(i.z=a.z+e(i._,a._),i.m=i.z-l):i.z=l}else a&&(i.z=a.z+e(i._,a._));i.parent.A=s(i,a,i.parent.A||p[0])}function u(i){i._.x=i.z+i.parent.m,i.m+=i.parent.m}function s(i,d,p){if(d){for(var a=i,l=i,f=d,g=a.parent.children[0],x=a.m,z=l.m,o=f.m,k=g.m,w;f=B(f),a=m(a),f&&a;)g=m(g),l=B(l),l.a=i,w=f.z+o-a.z-x+e(f._,a._),w>0&&(U(X(f,i,p),i,w),x+=w,z+=w),o+=f.m,x+=a.m,k+=g.m,z+=l.m;f&&!B(l)&&(l.t=f,l.m+=o-z),a&&!m(g)&&(g.t=a,g.m+=x-k,p=i)}return p}function _(i){i.x*=n,i.y=i.depth*t}return h.separation=function(i){return arguments.length?(e=i,h):e},h.size=function(i){return arguments.length?(r=!1,n=+i[0],t=+i[1],h):r?null:[n,t]},h.nodeSize=function(i){return arguments.length?(r=!0,n=+i[0],t=+i[1],h):r?[n,t]:null},h}export{S as h,Z as t};
